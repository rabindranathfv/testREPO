!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs"),require("rxjs/operators"),require("@angular/core")):"function"==typeof define&&define.amd?define("angular-google-charts",["exports","rxjs","rxjs/operators","@angular/core"],e):e(t["angular-google-charts"]={},t.rxjs,t.rxjs.operators,t.ng.core)}(this,function(t,o,e,r){"use strict";var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var i=function(){return(i=Object.assign||function(t){for(var e,r=1,a=arguments.length;r<a;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function s(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var a,o,n=r.call(t),i=[];try{for(;(void 0===e||0<e--)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(r=n["return"])&&r.call(n)}finally{if(o)throw o.error}}return i}var a=new r.InjectionToken("GOOGLE_API_KEY"),c=function(){function t(t,e){this.localeId=t,this.googleApiKey=e,this.scriptSource="https://www.gstatic.com/charts/loader.js",this.onLoadSubject=new o.Subject,this.initialize()}return Object.defineProperty(t.prototype,"onReady",{get:function(){return this.doneLoading?o.Observable.create(function(t){t.next(!0),t.complete()}):this.onLoadSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"doneLoading",{get:function(){return"undefined"!=typeof google&&"undefined"!=typeof google.charts},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoading",{get:function(){var e=this;return!this.doneLoading&&Array.from(document.getElementsByTagName("script")).find(function(t){return t.src===e.scriptSource})!==undefined},enumerable:!0,configurable:!0}),t.prototype.loadChartPackages=function(r){var a=this;return o.Observable.create(function(t){var e={packages:r,language:a.localeId,mapsApiKey:a.googleApiKey};google.charts.load("45.2",e),google.charts.setOnLoadCallback(function(){t.next(),t.complete()})})},t.prototype.initialize=function(){var t=this;if(!this.doneLoading&&!this.isLoading){var e=this.createScriptElement();e.onload=function(){t.onLoadSubject.next(!0),t.onLoadSubject.complete()},e.onerror=function(){console.error("Failed to load the google chart script!"),t.onLoadSubject.error("Failed to load the google chart script!"),t.onLoadSubject.complete()}}},t.prototype.createScriptElement=function(){var t=document.createElement("script");return t.type="text/javascript",t.src=this.scriptSource,t.async=!0,document.getElementsByTagName("head")[0].appendChild(t),t},t.decorators=[{type:r.Injectable}],t.ctorParameters=function(){return[{type:String,decorators:[{type:r.Inject,args:[r.LOCALE_ID]}]},{type:String,decorators:[{type:r.Inject,args:[a]},{type:r.Optional}]}]},t}(),p=function(){function e(){}return e.getPackageForChartName=function(t){return e.ChartTypesToPackages[t]},e.ChartTypesToPackages={AnnotationChart:"annotationchart",AreaChart:"corechart",Bar:"bar",BarChart:"corechart",BubbleChart:"corechart",Calendar:"calendar",CandlestickChart:"corechart",ColumnChart:"corechart",ComboChart:"corechart",PieChart:"corechart",Gantt:"gantt",Gauge:"gauge",GeoChart:"geochart",Histogram:"corechart",Line:"line",LineChart:"corechart",Map:"map",OrgChart:"orgchart",Sankey:"sankey",Scatter:"scatter",ScatterChart:"corechart",SteppedAreaChart:"corechart",Table:"table",Timeline:"timeline",TreeMap:"treemap",WordTree:"wordtree"},e}(),h=function(){function t(t,e){this.element=t,this.loaderService=e,this.dynamicResize=!1,this.error=new r.EventEmitter,this.ready=new r.EventEmitter,this.select=new r.EventEmitter,this.mouseenter=new r.EventEmitter,this.mouseleave=new r.EventEmitter}return t.prototype.ngOnInit=function(){var t=this;if(null==this.chartData)throw new Error("Can't create a Google Chart without data!");this.loaderService.onReady.subscribe(function(){t.createChart()})},t.prototype.ngAfterViewInit=function(){this.addResizeListener()},t.prototype.ngOnChanges=function(){this.wrapper&&this.updateChart()},t.prototype.getChartElement=function(){return this.element.nativeElement.firstElementChild},t.prototype.createChart=function(){var t=this;this.loadNeededPackages().subscribe(function(){t.wrapper=new google.visualization.ChartWrapper,t.updateChart()})},t.prototype.loadNeededPackages=function(){return this.loaderService.loadChartPackages([p.getPackageForChartName(this.chartData.chartType)])},t.prototype.updateChart=function(){this.chartData.dataTable&&this.formatData(this.chartData.dataTable),this.wrapper.setChartType(this.chartData.chartType),this.wrapper.setDataTable(this.chartData.dataTable),this.wrapper.setOptions(this.chartData.options),this.wrapper.setDataSourceUrl(this.chartData.dataSourceUrl),this.wrapper.setQuery(this.chartData.query),this.wrapper.setRefreshInterval(this.chartData.refreshInterval),this.wrapper.setView(this.chartData.view),this.removeChartEvents(),this.registerChartEvents(),this.wrapper.draw(this.element.nativeElement)},t.prototype.formatData=function(e){if(this.formatter)if(this.formatter instanceof Array)this.formatter.forEach(function(t){t.formatter.format(e,t.colIndex)});else for(var t=0;t<e.getNumberOfColumns();t++)this.formatter.format(e,t)},t.prototype.addResizeListener=function(){var t=this;this.dynamicResize&&o.fromEvent(window,"resize").pipe(e.debounceTime(100)).subscribe(function(){t.ngOnChanges()})},t.prototype.removeChartEvents=function(){google.visualization.events.removeAllListeners(this.wrapper)},t.prototype.registerChartEvents=function(){var e=this;this.registerChartEvent("ready",function(){return e.ready.emit("Chart Ready")}),this.registerChartEvent("error",function(t){return e.error.emit(t)}),this.registerChartEvent("select",function(){var t=e.wrapper.getChart().getSelection();e.select.emit(t)}),this.registerChartEvent("onmouseover",function(t){return e.mouseenter.emit(t)}),this.registerChartEvent("onmouseout",function(t){return e.mouseleave.emit(t)})},t.prototype.registerChartEvent=function(t,e){google.visualization.events.addListener(this.wrapper,t,e)},t.decorators=[{type:r.Component,args:[{selector:"raw-chart",template:"",exportAs:"raw-chart",changeDetection:r.ChangeDetectionStrategy.OnPush,styles:[":host { width: fit-content; display: block; }"]}]}],t.ctorParameters=function(){return[{type:r.ElementRef},{type:c}]},t.propDecorators={chartData:[{type:r.Input}],formatter:[{type:r.Input}],dynamicResize:[{type:r.Input}],error:[{type:r.Output}],ready:[{type:r.Output}],select:[{type:r.Output}],mouseenter:[{type:r.Output}],mouseleave:[{type:r.Output}]},t}(),u=function(a){function t(t,e){var r=a.call(this,t,e)||this;return r.roles=new Array,r.width=undefined,r.height=undefined,r.options={},r}return function o(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(t,a),t.prototype.ngOnInit=function(){var t=this;if(null==this.type)throw new Error("Can't create a Google Chart without specifying a type!");if(null==this.data)throw new Error("Can't create a Google Chart without data!");this.chartData={chartType:this.type},this.loaderService.onReady.subscribe(function(){t.createChart()})},t.prototype.ngOnChanges=function(){this.wrapper&&(this.chartData={chartType:this.type,dataTable:this.getDataTable(),options:this.parseOptions()}),a.prototype.ngOnChanges.call(this)},t.prototype.parseOptions=function(){return i({title:this.title,width:this.width,height:this.height},this.options)},t.prototype.createChart=function(){var t=this;this.loadNeededPackages().subscribe(function(){t.chartData={chartType:t.type,dataTable:t.getDataTable(),options:t.parseOptions()},t.wrapper=new google.visualization.ChartWrapper,t.updateChart()})},t.prototype.getDataTable=function(){if(this.columnNames){var t=this.parseRoles(this.columnNames);return google.visualization.arrayToDataTable(function r(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t}([t],this.data),!1)}return google.visualization.arrayToDataTable(this.data,!0)},t.prototype.parseRoles=function(t){var p=this,h=t.slice();return this.roles&&this.roles.forEach(function(t){var e,r,a={type:t.type,role:t.role};if(t.p&&(a.p=t.p),null!=t.index){h.splice(t.index+1,0,a);try{for(var o=function s(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}(p.roles),n=o.next();!n.done;n=o.next()){var i=n.value;i!==t&&(i.index>t.index&&i.index++)}}catch(c){e={error:c}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(e)throw e.error}}}else h.push(a)}),h},t.decorators=[{type:r.Component,args:[{selector:"google-chart",template:"",exportAs:"google-chart",changeDetection:r.ChangeDetectionStrategy.OnPush,styles:[":host { width: fit-content; display: block; }"]}]}],t.ctorParameters=function(){return[{type:r.ElementRef},{type:c}]},t.propDecorators={data:[{type:r.Input}],columnNames:[{type:r.Input}],roles:[{type:r.Input}],title:[{type:r.Input}],width:[{type:r.Input}],height:[{type:r.Input}],options:[{type:r.Input}],type:[{type:r.Input}]},t}(h),l=[{provide:c,useFactory:f,deps:[r.LOCALE_ID,a]}],d=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[l,{provide:a,useValue:t||""}]}},e.decorators=[{type:r.NgModule,args:[{providers:[c],declarations:[u,h],exports:[u,h]}]}],e}();function f(t,e){return new c(t,e)}t.GoogleChartComponent=u,t.RawChartComponent=h,t.GoogleChartsModule=d,t.ScriptLoaderService=c,t.GoogleChartPackagesHelper=p,t.ɵa=l,t.ɵb=f,t.ɵc=a,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=angular-google-charts.umd.min.js.map